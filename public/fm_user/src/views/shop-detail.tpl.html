<!--   <header id="home">
    <div id="home-slider" class="carousel slide carousel-fade" data-ride="carousel">   
      <div class="carousel-inner">
        <div class="item active" style="background-image: url(fm_user/images/bg.jpg)">
            <div class="shop-detail">
                <div class="store-box">
                            <span class="storetitle">{{shopDetails.name}}</span>
                            <span class="storeplace">{{shopDetails.address}}</span>
                            <div class="rating">
                                <span class="rating-box">{{shopDetails.rating}}</span>
                                <span class="vote">{{shopDetails.votes}} votes</span>
                            </div>
                 </div>
                  <div class="share-box">
                            <ul>
                                <li>
                                    <div class="share-more wow fadeInUp" data-wow-duration="1000ms" data-wow-delay="500ms">
                                        <a href="#" class="btn-sharemore"><i class="fa fa-bookmark"></i>BookMark</a>
                                    </div>
                                </li>
                                <li>
                                    <div class="share-more wow fadeInUp" data-wow-duration="1000ms" data-wow-delay="500ms">
                                        <a href="#" class="btn-sharemore"><i class="fa fa-comment"></i> Write Review</a>
                                    </div>
                                </li>
                                <li>
                                    <div class="share-more wow fadeInUp" data-wow-duration="1000ms" data-wow-delay="500ms">
                                        <a href="#" class="btn-sharemore"><i class="fa fa-home"></i> Follow</a>
                                    </div>
                                </li>                                
                                <li>
                                    <div class="share-more wow fadeInUp" data-wow-duration="1000ms" data-wow-delay="500ms">
                                        <select id="example" ng-model="shopDetails.thisUsersRating">
                                            <option value="">-</option>
                                            <option value="1">1.0</option>
                                            <option value="2">2.0</option>
                                            <option value="3">3.0</option>
                                            <option value="4">4.0</option>
                                            <option value="5">5.0</option>
                                        </select>
                                    </div>
                                </li>
                            </ul>                           
                    </div>
            </div>
        </div>
      </div>
     
      <a id="tohash" href="#portfolio"><i class="fa fa-angle-down"></i></a>

    </div>
    <div class="main-nav">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">
            <h1><img class="img-responsive" src="fm_user/images/logo.png" alt="logo" width="300" height="500"></h1>
          </a>                    
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">                             
            <li class="scroll login"><a href="">Login</a></li>       
          </ul>
        </div>
      </div>
    </div>
  </header> -->

  
<section id="detail-tab">
    <div class="container">        
        <div class="row">
          <div class="col-lg-2  col-md-2  col-sm-2">
            hi
          </div>
          <div class="col-lg-5  col-md-5  col-sm-5">
          </div>
            <div class="col-lg-5  col-md-5  col-sm-5">
                <!-- TWEET WRAPPER START -->
                <div class="twt-wrapper">
                    <div class="panel panel-info">
                        <div class="panel-heading">
                            Share Your Comments
                        </div>
                        <div class="panel-body">
                            <textarea class="form-control" placeholder="Enter your comments..." rows="3"></textarea>
                            <br />
                            <div class="share-more wow fadeInUp" data-wow-duration="1000ms" data-wow-delay="500ms">
                                        <a href="#" class="btn-sharemore"><i class="fa fa-share"></i>Share</a>
                                    </div>
                            <div class="clearfix"></div>
                            <hr />
                            <ul class="media-list">
                                <li class="media">
                                    <a href="#" class="pull-left">
                                        <img src="fm_user/images/1.jpg" alt="" class="img-circle">
                                    </a>
                                    <div class="media-body">
                                        <span class="text-muted pull-right">
                                            <small class="text-muted">30 min ago</small>
                                        </span>
                                        <strong class="text-success">@ Rexona Kumi</strong>
                                        <p>
                                            Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                                            Lorem ipsum dolor sit amet, <a href="#"># consectetur adipiscing </a>.
                                        </p>
                                    </div>
                                </li>
                                <li class="media">
                                    <a href="#" class="pull-left">
                                        <img src="fm_user/images/2.jpg" alt="" class="img-circle">
                                    </a>
                                    <div class="media-body">
                                        <span class="text-muted pull-right">
                                            <small class="text-muted">30 min ago</small>
                                        </span>
                                        <strong class="text-success">@ John Doe</strong>
                                        <p>
                                            Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                                            Lorem ipsum dolor <a href="#"># ipsum dolor </a>adipiscing elit.
                                        </p>
                                    </div>
                                </li>
                                <li class="media">
                                    <a href="#" class="pull-left">
                                        <img src="fm_user/images/3.jpg" alt="" class="img-circle">
                                    </a>
                                    <div class="media-body">
                                        <span class="text-muted pull-right">
                                            <small class="text-muted">30 min ago</small>
                                        </span>
                                        <strong class="text-success">@ Madonae Jonisyi</strong>
                                        <p>
                                            Lorem ipsum dolor <a href="#"># sit amet</a> sit amet, consectetur adipiscing elit.Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                                        </p>
                                    </div>
                                </li>
                            </ul>                            
                        </div>
                    </div>
                </div>
                 <!-- TWEET WRAPPER END -->
            </div>
        </div>
    </div>
</section>


<footer id="footer">
    <div class="footer-top wow fadeInUp" data-wow-duration="1000ms" data-wow-delay="300ms">
        <div class="container text-center">
            <div class="footer-logo">
                <a href="index.html"><img class="img-responsive" src="fm_user/images/logo.png" alt=""></a>
            </div>
            <div class="social-icons">
                <ul>
                    <li><a class="envelope" href="#"><i class="fa fa-envelope"></i></a></li>
                    <li><a class="twitter" href="#"><i class="fa fa-twitter"></i></a></li>
                    <li><a class="dribbble" href="#"><i class="fa fa-dribbble"></i></a></li>
                    <li><a class="facebook" href="#"><i class="fa fa-facebook"></i></a></li>
                    <li><a class="linkedin" href="#"><i class="fa fa-linkedin"></i></a></li>
                    <li><a class="tumblr" href="#"><i class="fa fa-tumblr-square"></i></a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="footer-bottom">
        <div class="container">
            <div class="row">
                <div class="col-sm-6">
                    <p>&copy; 2014 Smashers.</p>
                </div>
                <div class="col-sm-6">
                    <p class="pull-right">Designed by <a href="http://www.themeum.com/">Smashers</a></p>
                </div>
            </div>
        </div>
    </div>
</footer>



<style type="text/css">
        #home-slider .shop-detail {
          position: absolute;
          top: 80%;
          margin-top: -104px;
          left: 10%;
          text-align: left;
          text-transform: uppercase;
          z-index: 15;
          font-size: 18px;
          font-weight: 300;
          color: #ffffff;
          padding-left: 10px;
          padding-right: 10px;
          border-radius: 10px;
          width: 70%;
          height: 20%;
          color: #fff;
          font-size: 60px;
          font-weight: 700;
          margin-bottom: 10px;
          background: none repeat scroll 0 0 rgba(0, 0, 0, 0);
        }





/*=======================================
TWEET FEED STYLES
==================================================*/
.twt-wrapper .panel-body {
    overflow:auto;
}
.twt-wrapper .media-list .media img {
    width:64px;
    height:64px;
    border:2px solid #e5e7e8;
}
.twt-wrapper .media-list .media {
    border-bottom:1px dashed #efefef;
    margin-bottom:25px;
}

.twt-wrapper .form-control {
  border-color: rgb(249, 240, 240) !important;
}
.twt-wrapper .panel-info>.panel-heading {
  background-color: #ffffff !important;
  border-color: #ffffff !important;
}




.branch-box{
    margin-bottom: 15px;
    overflow: hidden;
}
.branch-box  img{
    width: 100%;
    height: 100%;
}
.highlight-tag{
        float: left;
    background: #0C5EB3;
        width: 174px;
    -webkit-transform: rotateZ(-45deg);
    top: 37px;
    position: absolute;
    left: -38px;
    height: 30px;
    color: white;
    box-shadow: -1px -1px 10px #DDD;
}
.offer-box img{
    width: 100%;
    height: 100%;
}
.ribbon {
  float: left;
  left: 40px;
  top: -4px;
    position: absolute;
}
/* End demo css */

.ribbon {
  display: block;
  width: 30px;
  position: relative;
  color: #fff;
  padding: 20px 0 10px;
  text-align: center;
  font-family: arial, sans-serif;
  font-weight: bold;
  text-shadow: 0px -1px 0px rgba(0, 0, 0, 0.3);
}

.ribbon:before {
  display: block;
  width: 30px;
  height: 0;
  position: absolute;
  top: 4px;
  content: "";
  border-top: 1px dotted rgba(0, 0, 0, 0.2);
  border-bottom: 1px dotted rgba(255, 255, 255, 0.3);
}

.ribbon:after {
  display: block;
  width: 0;
  height: 0;
  content: "";
  position: relative;
  bottom: -25px;
  z-index: 100;
  border-width: 0 15px 15px 15px;
  border-style: solid;
}

/* 
    Ribbon colors 
*/
.ribbon.red {
  background-color: #cb0000;
  background-repeat: repeat-x;
  background-image: -khtml-gradient(linear, left top, left bottom, from(#fe0000), to(#cb0000));
  background-image: -moz-linear-gradient(top, #fe0000, #cb0000);
  background-image: -ms-linear-gradient(top, #fe0000, #cb0000);
  background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #fe0000), color-stop(100%, #cb0000));
  background-image: -webkit-linear-gradient(top, #fe0000, #cb0000);
  background-image: -o-linear-gradient(top, #fe0000, #cb0000);
  background-image: linear-gradient(top, #fe0000, #cb0000);
  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#fe0000', endColorstr='#cb0000', GradientType=0);
}
.ribbon.red:after {
  border-color: #cb0000 #cb0000 transparent #cb0000;
}
.comment-date .time-stamp {
    top: -3px;
position: relative;
  font-style: italic;
}
.comment-date i {
  color: #028fcc;
  font-size: 20px;
  margin-right: 10px;
}
#og-grid-offer img {
  height: 250px;
  width: 300px;
border-radius: 6px;
}
.user-thumbnail {
  border-radius: 78px;
   /* border-color: #028fcc;*/
        padding: 12px;
}
.user-thumbnail img {
  width: 120px;
  height: 120px;
  border-radius: 61px;
}
.comment-list .row {
margin-bottom: 0px;
}
.comment-list .panel .panel-heading {
padding: 4px 15px;
position: absolute;
border:none;
/*Panel-heading border radius*/
border-top-right-radius:0px;
top: 1px;
}
.comment-list .panel .panel-heading.right {
border-right-width: 0px;
/*Panel-heading border radius*/
border-top-left-radius:0px;
right: 16px;
}
.comment-list .panel .panel-heading .panel-body {
padding-top: 6px;
}
.comment-list figcaption {
/*For wrap text is thumbnail*/
word-wrap: break-word;
font-weight: bold;
    color: #169FA7;
}
/* Portrait tablets and medium desktops */
@media (min-width: 768px) {
.comment-list .arrow:after, .comment-list .arrow:before {
content: "";
position: absolute;
width: 0;
height: 0;
border-style: solid;
border-color: transparent;
}
.comment-list .panel.arrow.left:after, .comment-list .panel.arrow.left:before {
border-left: 0;
}
/*****Left Arrow*****/
/*Outline effect style*/
.comment-list .panel.arrow.left:before {
left: 0px;
top: 30px;
/*Use boarder color of panel*/
border-right-color: inherit;
border-width: 16px;
}
/*Background color effect*/
.comment-list .panel.arrow.left:after {
left: 1px;
top: 31px;
/*Change for different outline color*/
border-right-color: #FFFFFF;
border-width: 15px;
}
/*****Right Arrow*****/
/*Outline effect style*/
.comment-list .panel.arrow.right:before {
right: -16px;
top: 30px;
/*Use boarder color of panel*/
border-left-color: inherit;
border-width: 16px;
}
/*Background color effect*/
.comment-list .panel.arrow.right:after {
right: -14px;
top: 31px;
/*Change for different outline color*/
border-left-color: #FFFFFF;
border-width: 15px;
}
}
.comment-list .comment-post {
margin-top: 6px;
text-align: left;
}



section#detail-tab{
margin-top: -90px;
}

.widget-area.blank {
background: none repeat scroll 0 0 rgba(0, 0, 0, 0);
-webkit-box-shadow: none;
-moz-box-shadow: none;
-ms-box-shadow: none;
-o-box-shadow: none;
box-shadow: none;
}

.widget-area {
background-color: #fff;
-webkit-border-radius: 4px;
-moz-border-radius: 4px;
-ms-border-radius: 4px;
-o-border-radius: 4px;
border-radius: 4px;
-webkit-box-shadow: 0 0 16px rgba(0, 0, 0, 0.05);
-moz-box-shadow: 0 0 16px rgba(0, 0, 0, 0.05);
-ms-box-shadow: 0 0 16px rgba(0, 0, 0, 0.05);
-o-box-shadow: 0 0 16px rgba(0, 0, 0, 0.05);
box-shadow: 0 0 16px rgba(0, 0, 0, 0.05);
float: left;
margin-top: 30px;
padding: 25px 30px;
position: relative;
width: 100%;
}
.status-upload {
background: none repeat scroll 0 0 #f5f5f5;
-webkit-border-radius: 4px;
-moz-border-radius: 4px;
-ms-border-radius: 4px;
-o-border-radius: 4px;
border-radius: 4px;
float: left;
width: 100%;
}
.status-upload form {
float: left;
width: 100%;
}
.status-upload form textarea {
background: none repeat scroll 0 0 #fff;
border: medium none;
-webkit-border-radius: 4px 4px 0 0;
-moz-border-radius: 4px 4px 0 0;
-ms-border-radius: 4px 4px 0 0;
-o-border-radius: 4px 4px 0 0;
border-radius: 4px 4px 0 0;
color: #777777;
float: left;
font-family: Lato;
font-size: 14px;
height: 142px;
letter-spacing: 0.3px;
padding: 20px;
width: 100%;
resize:vertical;
outline:none;
border: 1px solid #F2F2F2;
}

.status-upload ul {
float: left;
list-style: none outside none;
margin: 0;
padding: 0 0 0 15px;
width: auto;
}
.status-upload ul > li {
float: left;
}
.status-upload ul > li > a {
-webkit-border-radius: 4px;
-moz-border-radius: 4px;
-ms-border-radius: 4px;
-o-border-radius: 4px;
border-radius: 4px;
color: #777777;
float: left;
font-size: 14px;
height: 30px;
line-height: 30px;
margin: 10px 0 10px 10px;
text-align: center;
-webkit-transition: all 0.4s ease 0s;
-moz-transition: all 0.4s ease 0s;
-ms-transition: all 0.4s ease 0s;
-o-transition: all 0.4s ease 0s;
transition: all 0.4s ease 0s;
width: 30px;
cursor: pointer;
}
.status-upload ul > li > a:hover {
background: none repeat scroll 0 0 #028fcc;
color: #fff;
}
.status-upload form button {
border: medium none;
-webkit-border-radius: 4px;
-moz-border-radius: 4px;
-ms-border-radius: 4px;
-o-border-radius: 4px;
border-radius: 4px;
color: #fff;
float: right;
font-family: Lato;
font-size: 14px;
letter-spacing: 0.3px;
margin-right: 9px;
margin-top: 9px;
padding: 6px 15px;
}
.dropdown > a > span.green:before {
border-left-color: #2dcb73;
}
.status-upload form button > i {
margin-right: 7px;
}


.detail-tab{
margin-top: 5px;
}

section#detail{
padding-top: 10px !important;
padding-bottom: 10px !important;
}

section#others{
padding-top: 10px !important;
}

.divider{
border-bottom: solid 3px #028fcc;
}
.userfollow16 {
width: 100%;
float: left;
}

.followcomment {
width: 85%;
float: left;
color: #898989;
font-size: 14px;
margin-top: -5px;
margin-bottom: 0;
}

.share-more {
display:block;
text-align: center;
margin-top: 10px;
}

.btn-sharemore {
border: 1px solid #666666;
color: #666666;
font-size: 12px;
font-weight: 600;
padding: 8px 8px;
text-transform: uppercase;
border-radius: 4px;
}

.btn-sharemore i{
font-size: 20px;
}

.btn-sharemore:hover {
background-color: #017fb5;
color:#fff !important;
}
.store-detail{
margin-left: 20px;
margin-right: 20px;
}
.store-panel {
box-shadow: none;
}
.store-panel {
background: #fff;
float: left;
width: 100%;
-ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=3, Direction=180, Color=#ada6a6)";
-moz-box-shadow: 0px -3px 7px #ada6a6;

-webkit-box-shadow: 0px -3px 7px #ada6a6;
box-shadow: 0px -3px 7px #ada6a6;
filter: progid:DXImageTransform.Microsoft.Shadow(Strength=3,Direction=180,Color=#ada6a6);
border-radius: 4px;
border: #ececec solid 1px;
padding: 28px 18px 28px 18px;
margin-top: 10px;
}
.store-box span.storetitle {
font-size: 24px;
float: left;
font-weight: 600;
}
.store-box span.storeplace {
font-size: 16px;
font-weight: 400;
width: 100%;
float: left;
padding-top: 10px;
}
.rating {
float: right;
color: #898989;
font-size: 13px;
font-weight: 400;
margin-top: -15px;
}
.store-box .rating-box {
background: #028fcc none repeat scroll 0 0;
border-radius: 5px;
color: #fff;
display: inline-block;
font-size: 18px;
font-weight: 700;
height: 28px;
line-height: 28px;
position: relative;
right: 35px;
top: -25px;
float: right;
font-weight: 700;
margin-left: -10px;
text-align: center;
width: 45px;
}
span.vote {
padding-top: 2px;
}
/*
.followbx16 .follow-share-box {
margin-top: 0;
margin-bottom: 10px;
position: relative;
}*/
.share-box {
width: 100%;
float: left;
}


.share-box ul {
padding: 0;
margin: 10px 0 0 0;
width: 100%;
}

.share-box li {
padding: 0;
margin: 0;
list-style: none;
float: left;
width: auto;
font-size: 14px;
margin-right: 25px;
color: #898989;
}
.btn-categorymore {
     border: 1px solid #028fcc;
    }
.og-grid li > a{
    overflow: hidden;
transition:top 0.5s;
}
.og-grid li > a img{
    overflow: hidden;
    top:0;
    transition:top 0.5s;
}
.og-grid li > a .img-desc{
    display: block;
    position: absolute;
    height: 45px;
    background: black;
    bottom: -40px;
    width: 100%;
    transition:bottom 0.5s;
    color: white;
    font-weight: bold;
    font-style: italic;

}
.og-grid li > a:hover img{
    top:-45px;
   
}
.og-grid li > a:hover .img-desc{
    bottom: 0px;
    padding-left: 5px;
}
.img-desc span:first-child {
  display: block;
  text-align: left;
}
.img-desc span:last-child {
     display: block;
  text-align: left;
}

</style>

<script type="text/javascript">
   $(function() {

       $('#example').barrating('show', {
           theme: 'bars-1to10'
       });
   });

   /**
    * cbpFWTabs.js v1.0.0
    * http://www.codrops.com
    *
    * Licensed under the MIT license.
    * http://www.opensource.org/licenses/mit-license.php
    *
    * Copyright 2014, Codrops
    * http://www.codrops.com
    */
   ;
   (function(window) {

       'use strict';

       function extend(a, b) {
           for (var key in b) {
               if (b.hasOwnProperty(key)) {
                   a[key] = b[key];
               }
           }
           return a;
       }

       function CBPFWTabs(el, options) {
           this.el = el;
           this.options = extend({}, this.options);
           extend(this.options, options);
           this._init();
       }

       CBPFWTabs.prototype.options = {
           start: 0
       };

       CBPFWTabs.prototype._init = function() {
           // tabs elems
           this.tabs = [].slice.call(this.el.querySelectorAll('nav > ul > li'));
           // content items
           this.items = [].slice.call(this.el.querySelectorAll('.content-wrap > section'));
           // current index
           this.current = -1;
           // show current content item
           this._show();
           // init events
           this._initEvents();
       };

       CBPFWTabs.prototype._initEvents = function() {
           var self = this;
           this.tabs.forEach(function(tab, idx) {
               tab.addEventListener('click', function(ev) {
                   ev.preventDefault();
                   self._show(idx);
               });
           });
       };

       CBPFWTabs.prototype._show = function(idx) {
           if (this.current >= 0) {
               this.tabs[this.current].className = this.items[this.current].className = '';
           }
           // change current
           this.current = idx != undefined ? idx : this.options.start >= 0 && this.options.start < this.items.length ? this.options.start : 0;
           this.tabs[this.current].className = 'tab-current';
           this.items[this.current].className = 'content-current';
       };

       // add to global namespace
       window.CBPFWTabs = CBPFWTabs;

   })(window);


   /*
    * debouncedresize: special jQuery event that happens once after a window resize
    *
    * latest version and complete README available on Github:
    * https://github.com/louisremi/jquery-smartresize/blob/master/jquery.debouncedresize.js
    *
    * Copyright 2011 @louis_remi
    * Licensed under the MIT license.
    */
   var $event = $.event,
       $special,
       resizeTimeout;

   $special = $event.special.debouncedresize = {
       setup: function() {
           $(this).on("resize", $special.handler);
       },
       teardown: function() {
           $(this).off("resize", $special.handler);
       },
       handler: function(event, execAsap) {
           // Save the context
           var context = this,
               args = arguments,
               dispatch = function() {
                   // set correct event type
                   event.type = "debouncedresize";
                   $event.dispatch.apply(context, args);
               };

           if (resizeTimeout) {
               clearTimeout(resizeTimeout);
           }

           execAsap ?
               dispatch() :
               resizeTimeout = setTimeout(dispatch, $special.threshold);
       },
       threshold: 250
   };

   // ======================= imagesLoaded Plugin ===============================
   // https://github.com/desandro/imagesloaded

   // $('#my-container').imagesLoaded(myFunction)
   // execute a callback when all images have loaded.
   // needed because .load() doesn't work on cached images

   // callback function gets image collection as argument
   //  this is the container

   // original: MIT license. Paul Irish. 2010.
   // contributors: Oren Solomianik, David DeSandro, Yiannis Chatzikonstantinou

   // blank image data-uri bypasses webkit log warning (thx doug jones)
   var BLANK = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';

   $.fn.imagesLoaded = function(callback) {
       var $this = this,
           deferred = $.isFunction($.Deferred) ? $.Deferred() : 0,
           hasNotify = $.isFunction(deferred.notify),
           $images = $this.find('img').add($this.filter('img')),
           loaded = [],
           proper = [],
           broken = [];

       // Register deferred callbacks
       if ($.isPlainObject(callback)) {
           $.each(callback, function(key, value) {
               if (key === 'callback') {
                   callback = value;
               } else if (deferred) {
                   deferred[key](value);
               }
           });
       }

       function doneLoading() {
           var $proper = $(proper),
               $broken = $(broken);

           if (deferred) {
               if (broken.length) {
                   deferred.reject($images, $proper, $broken);
               } else {
                   deferred.resolve($images);
               }
           }

           if ($.isFunction(callback)) {
               callback.call($this, $images, $proper, $broken);
           }
       }

       function imgLoaded(img, isBroken) {
           // don't proceed if BLANK image, or image is already loaded
           if (img.src === BLANK || $.inArray(img, loaded) !== -1) {
               return;
           }

           // store element in loaded images array
           loaded.push(img);

           // keep track of broken and properly loaded images
           if (isBroken) {
               broken.push(img);
           } else {
               proper.push(img);
           }

           // cache image and its state for future calls
           $.data(img, 'imagesLoaded', {
               isBroken: isBroken,
               src: img.src
           });

           // trigger deferred progress method if present
           if (hasNotify) {
               deferred.notifyWith($(img), [isBroken, $images, $(proper), $(broken)]);
           }

           // call doneLoading and clean listeners if all images are loaded
           if ($images.length === loaded.length) {
               setTimeout(doneLoading);
               $images.unbind('.imagesLoaded');
           }
       }

       // if no images, trigger immediately
       if (!$images.length) {
           doneLoading();
       } else {
           $images.bind('load.imagesLoaded error.imagesLoaded', function(event) {
               // trigger imgLoaded
               imgLoaded(event.target, event.type === 'error');
           }).each(function(i, el) {
               var src = el.src;

               // find out if this image has been already checked for status
               // if it was, and src has not changed, call imgLoaded on it
               var cached = $.data(el, 'imagesLoaded');
               if (cached && cached.src === src) {
                   imgLoaded(el, cached.isBroken);
                   return;
               }

               // if complete is true and browser supports natural sizes, try
               // to check for image status manually
               if (el.complete && el.naturalWidth !== undefined) {
                   imgLoaded(el, el.naturalWidth === 0 || el.naturalHeight === 0);
                   return;
               }

               // cached images don't fire load sometimes, so we reset src, but only when
               // dealing with IE, or image is complete (loaded) and failed manual check
               // webkit hack from http://groups.google.com/group/jquery-dev/browse_thread/thread/eee6ab7b2da50e1f
               if (el.readyState || el.complete) {
                   el.src = BLANK;
                   el.src = src;
               }
           });
       }

       return deferred ? deferred.promise($this) : $this;
   };

   var OgGrid = (function() {

       // list of items
       var $grid = {},
           // the items
           $items = {};
       // current expanded item's index
       var current = -1,
           // position (top) of the expanded item
           // used to know if the preview will expand in a different row
           previewPos = -1,
           // extra amount of pixels to scroll the window
           scrollExtra = 0,
           // extra margin when expanded (between preview overlay and the next items)
           marginExpanded = 10,
           $window = $(window),
           winsize,
           $body = $('html, body'),
           // transitionend events
           transEndEventNames = {
               'WebkitTransition': 'webkitTransitionEnd',
               'MozTransition': 'transitionend',
               'OTransition': 'oTransitionEnd',
               'msTransition': 'MSTransitionEnd',
               'transition': 'transitionend'
           },
           transEndEventName = transEndEventNames[Modernizr.prefixed('transition')],
           // support for csstransitions
           support = Modernizr.csstransitions,
           // default settings
           settings = {
               minHeight: 500,
               speed: 350,
               easing: 'ease'
           };

       function init(elementId, config) {

           // list of items
           $grid[elementId] = $('#' + elementId);
           // the items
           $items[elementId] = $('#' + elementId + ' li');
           console.log("in grid init1 : " + JSON.stringify($grid));
           console.log("in grid init : " + JSON.stringify($items));

           // the settings..
           settings = $.extend(true, {}, settings, config);

           // preload all images
           $grid[elementId].imagesLoaded(function() {

               // save item´s size and offset
               saveItemInfo(elementId, true);
               // get window´s size
               getWinSize();
               // initialize some events
               initEvents(elementId);

           });

       }

       // add more items to the grid.
       // the new items need to appended to the grid.
       // after that call OgGrid.addItems(elementId, theItems);
       function addItems(elementId, $newitems) {
           $items = $items[elementId].add($newitems);

           $newitems.each(function() {
               var $item = $(this);
               $item.data({
                   offsetTop: $item.offset().top,
                   height: $item.height()
               });
           });

           initItemsEvents($newitems);

       }

       // saves the item´s offset top and height (if saveheight is true)
       function saveItemInfo(elementId, saveheight) {
           $items[elementId].each(function() {
               var $item = $(this);
               $item.data('offsetTop', $item.offset().top);
               if (saveheight) {
                   $item.data('height', $item.height());
               }
           });
       }

       function initEvents(elementId) {

           // when clicking an item, show the preview with the item´s info and large image.
           // close the item if already expanded.
           // also close if clicking on the item´s cross
           initItemsEvents(elementId, $items);

           // on window resize get the window´s size again
           // reset some values..
           $window.on('debouncedresize', function() {

               scrollExtra = 0;
               previewPos = -1;
               // save item´s offset
               saveItemInfo(elementId);
               getWinSize();
               var preview = $.data(this, 'preview');
               if (typeof preview != 'undefined') {
                   hidePreview();
               }

           });

       }

       function initItemsEvents(elementId, $items) {
           $items[elementId].on('click', function() {
               hidePreview();
               return false;
           }).children('a').on('click', function(e) {

               var $item = $(this).parent();
               // check if item already opened
               current === $item.index() ? hidePreview() : showPreview($item);
               return false;

           });
       }

       function getWinSize() {
           winsize = {
               width: $window.width(),
               height: $window.height()
           };
       }

       function showPreview($item) {

           var preview = $.data(this, 'preview'),
               // item´s offset top
               position = $item.data('offsetTop');

           scrollExtra = 0;

           // if a preview exists and previewPos is different (different row) from item´s top then close it
           if (typeof preview != 'undefined') {

               // not in the same row
               if (previewPos !== position) {
                   // if position > previewPos then we need to take te current preview´s height in consideration when scrolling the window
                   if (position > previewPos) {
                       scrollExtra = preview.height;
                   }
                   hidePreview();
               }
               // same row
               else {
                   preview.update($item);
                   return false;
               }

           }

           // update previewPos
           previewPos = position;
           // initialize new preview for the clicked item
           preview = $.data(this, 'preview', new Preview($item));
           // expand preview overlay
           preview.open();

       }

       function hidePreview() {
           current = -1;
           var preview = $.data(this, 'preview');
           preview.close();
           $.removeData(this, 'preview');
       }

       // the preview obj / overlay
       function Preview($item) {
           this.$item = $item;
           this.expandedIdx = this.$item.index();
           this.create();
           this.update();
       }

       Preview.prototype = {
           create: function() {
               // create Preview structure:
               this.$title = $('<h3></h3>');
               this.$description = $('<p></p>');
               this.$href = $('<a href="#">Visit website</a>');
               this.$details = $('<div class="og-details"></div>').append(this.$title, this.$description, this.$href);
               this.$loading = $('<div class="og-loading"></div>');
               this.$fullimage = $('<div class="og-fullimg"></div>').append(this.$loading);
               this.$closePreview = $('<span class="og-close"></span>');
               this.$previewInner = $('<div class="og-expander-inner"></div>').append(this.$closePreview, this.$fullimage, this.$details);
               this.$previewEl = $('<div class="og-expander"></div>').append(this.$previewInner);
               // append preview element to the item
               this.$item.append(this.getEl());
               // set the transitions for the preview and the item
               if (support) {
                   this.setTransition();
               }
           },
           update: function($item) {

               if ($item) {
                   this.$item = $item;
               }

               // if already expanded remove class "og-expanded" from current item and add it to new item
               if (current !== -1) {
                   var $currentItem = $items.eq(current);
                   $currentItem.removeClass('og-expanded');
                   this.$item.addClass('og-expanded');
                   // position the preview correctly
                   this.positionPreview();
               }

               // update current value
               current = this.$item.index();

               // update preview´s content
               var $itemEl = this.$item.children('a'),
                   eldata = {
                       href: $itemEl.attr('href'),
                       largesrc: $itemEl.data('largesrc'),
                       title: $itemEl.data('title'),
                       description: $itemEl.data('description')
                   };

               this.$title.html(eldata.title);
               this.$description.html(eldata.description);
               this.$href.attr('href', eldata.href);

               var self = this;

               // remove the current image in the preview
               if (typeof self.$largeImg != 'undefined') {
                   self.$largeImg.remove();
               }

               // preload large image and add it to the preview
               // for smaller screens we don´t display the large image (the media query will hide the fullimage wrapper)
               if (self.$fullimage.is(':visible')) {
                   this.$loading.show();
                   $('<img/>').load(function() {
                       var $img = $(this);
                       if ($img.attr('src') === self.$item.children('a').data('largesrc')) {
                           self.$loading.hide();
                           self.$fullimage.find('img').remove();
                           self.$largeImg = $img.fadeIn(350);
                           self.$fullimage.append(self.$largeImg);
                       }
                   }).attr('src', eldata.largesrc);
               }

           },
           open: function() {

               setTimeout($.proxy(function() {
                   // set the height for the preview and the item
                   this.setHeights();
                   // scroll to position the preview in the right place
                   this.positionPreview();
               }, this), 25);

           },
           close: function() {

               var self = this,
                   onEndFn = function() {
                       if (support) {
                           $(this).off(transEndEventName);
                       }
                       self.$item.removeClass('og-expanded');
                       self.$previewEl.remove();
                   };

               setTimeout($.proxy(function() {

                   if (typeof this.$largeImg !== 'undefined') {
                       this.$largeImg.fadeOut('fast');
                   }
                   this.$previewEl.css('height', 0);
                   // the current expanded item (might be different from this.$item)
                   var $expandedItem = $items.eq(this.expandedIdx);
                   $expandedItem.css('height', $expandedItem.data('height')).on(transEndEventName, onEndFn);

                   if (!support) {
                       onEndFn.call();
                   }

               }, this), 25);

               return false;

           },
           calcHeight: function() {

               var heightPreview = winsize.height - this.$item.data('height') - marginExpanded,
                   itemHeight = winsize.height;

               if (heightPreview < settings.minHeight) {
                   heightPreview = settings.minHeight;
                   itemHeight = settings.minHeight + this.$item.data('height') + marginExpanded;
               }

               this.height = heightPreview;
               this.itemHeight = itemHeight;

           },
           setHeights: function() {

               var self = this,
                   onEndFn = function() {
                       if (support) {
                           self.$item.off(transEndEventName);
                       }
                       self.$item.addClass('og-expanded');
                   };

               this.calcHeight();
               this.$previewEl.css('height', this.height);
               this.$item.css('height', this.itemHeight).on(transEndEventName, onEndFn);

               if (!support) {
                   onEndFn.call();
               }

           },
           positionPreview: function() {

               // scroll page
               // case 1 : preview height + item height fits in window´s height
               // case 2 : preview height + item height does not fit in window´s height and preview height is smaller than window´s height
               // case 3 : preview height + item height does not fit in window´s height and preview height is bigger than window´s height
               var position = this.$item.data('offsetTop'),
                   previewOffsetT = this.$previewEl.offset().top - scrollExtra,
                   scrollVal = this.height + this.$item.data('height') + marginExpanded <= winsize.height ? position : this.height < winsize.height ? previewOffsetT - (winsize.height - this.height) : previewOffsetT;

               $body.animate({
                   scrollTop: scrollVal
               }, settings.speed);

           },
           setTransition: function() {
               this.$previewEl.css('transition', 'height ' + settings.speed + 'ms ' + settings.easing);
               this.$item.css('transition', 'height ' + settings.speed + 'ms ' + settings.easing);
           },
           getEl: function() {
               return this.$previewEl;
           }
       }

       return {
           init: init,
           addItems: addItems
       };
   })();

   (function() {
       [].slice.call(document.querySelectorAll('.tabs')).forEach(function(el) {
           new CBPFWTabs(el);
       });
   })();
</script>